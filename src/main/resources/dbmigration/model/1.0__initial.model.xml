<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<migration xmlns="http://ebean-orm.github.io/xml/ns/dbmigration">
    <changeSet type="apply">
        <createTable name="categories" pkName="pk_categories">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="name" type="varchar" notnull="true"/>
            <column name="description" type="varchar"/>
            <column name="avatar" type="varchar"/>
            <column name="user_id" type="bigint" references="users.id" foreignKeyName="fk_categories_user_id" foreignKeyIndex="ix_categories_user_id"/>
            <column name="created_at" type="timestamp" notnull="true"/>
            <column name="updated_at" type="timestamp" notnull="true"/>
            <column name="is_deleted" type="boolean" defaultValue="false" notnull="true"/>
        </createTable>
        <createTable name="friendships" pkName="pk_friendships">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="friendship_id" type="varchar"/>
            <column name="user_id" type="bigint" references="users.id" foreignKeyName="fk_friendships_user_id" foreignKeyIndex="ix_friendships_user_id"/>
            <column name="friend_id" type="bigint" references="users.id" foreignKeyName="fk_friendships_friend_id" foreignKeyIndex="ix_friendships_friend_id"/>
            <column name="status" type="varchar(8)" defaultValue="'PENDING'" checkConstraint="check ( status in ('PENDING','ACCEPTED','REJECTED','BLOCKED'))" checkConstraintName="ck_friendships_status"/>
            <column name="created_at" type="timestamp" notnull="true"/>
            <column name="updated_at" type="timestamp" notnull="true"/>
            <column name="is_deleted" type="boolean" defaultValue="false" notnull="true"/>
            <uniqueConstraint name="uq_friendships_friendship_id" columnNames="friendship_id" oneToOne="false" nullableColumns="friendship_id"/>
        </createTable>
        <createTable name="paid_by" pkName="pk_paid_by">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="transaction_id" type="bigint" notnull="true"/>
            <column name="user_id" type="bigint" notnull="true"/>
            <column name="amount" type="double" notnull="true"/>
            <column name="created_at" type="timestamp" notnull="true"/>
            <column name="updated_at" type="timestamp" notnull="true"/>
            <column name="is_deleted" type="boolean" defaultValue="false" notnull="true"/>
            <uniqueConstraint name="uq_paid_by_transaction_id" columnNames="transaction_id" oneToOne="false" nullableColumns=""/>
        </createTable>
        <createTable name="settlements" pkName="pk_settlements">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="amount" type="double" notnull="true"/>
            <column name="currency" type="varchar(3)" defaultValue="'INR'" notnull="true" checkConstraint="check ( currency in ('INR','USD'))" checkConstraintName="ck_settlements_currency"/>
            <column name="date" type="date"/>
            <column name="user_id" type="bigint" references="users.id" foreignKeyName="fk_settlements_user_id" foreignKeyIndex="ix_settlements_user_id"/>
            <column name="friend_id" type="bigint" references="users.id" foreignKeyName="fk_settlements_friend_id" foreignKeyIndex="ix_settlements_friend_id"/>
            <column name="payment_method" type="varchar(4)" checkConstraint="check ( payment_method in ('CASH'))" checkConstraintName="ck_settlements_payment_method"/>
            <column name="created_at" type="timestamp" notnull="true"/>
            <column name="updated_at" type="timestamp" notnull="true"/>
            <column name="is_deleted" type="boolean" defaultValue="false" notnull="true"/>
        </createTable>
        <createTable name="split_details" pkName="pk_split_details">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="transaction_id" type="bigint" notnull="true"/>
            <column name="user_id" type="bigint" notnull="true"/>
            <column name="amount" type="double" notnull="true"/>
            <column name="split_type" type="varchar(10)" defaultValue="'EQUAL'" notnull="true" checkConstraint="check ( split_type in ('EQUAL','PERCENTAGE','AMOUNT'))" checkConstraintName="ck_split_details_split_type"/>
            <column name="created_at" type="timestamp" notnull="true"/>
            <column name="updated_at" type="timestamp" notnull="true"/>
            <column name="is_deleted" type="boolean" defaultValue="false" notnull="true"/>
            <uniqueConstraint name="uq_split_details_transaction_id" columnNames="transaction_id" oneToOne="false" nullableColumns=""/>
        </createTable>
        <createTable name="transactions" pkName="pk_transactions">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="description" type="varchar"/>
            <column name="amount" type="double" notnull="true"/>
            <column name="date" type="date"/>
            <column name="type" type="varchar(13)" defaultValue="'EXPENSE'" notnull="true" checkConstraint="check ( type in ('INCOME','EXPENSE','SELF_TRANSFER','INVESTMENT'))" checkConstraintName="ck_transactions_type"/>
            <column name="currency" type="varchar(3)" defaultValue="'INR'" notnull="true" checkConstraint="check ( currency in ('INR','USD'))" checkConstraintName="ck_transactions_currency"/>
            <column name="category_id" type="bigint" references="categories.id" foreignKeyName="fk_transactions_category_id" foreignKeyIndex="ix_transactions_category_id"/>
            <column name="created_at" type="timestamp" notnull="true"/>
            <column name="updated_at" type="timestamp" notnull="true"/>
            <column name="is_deleted" type="boolean" defaultValue="false" notnull="true"/>
        </createTable>
        <createTable name="users" pkName="pk_users">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="first_name" type="varchar"/>
            <column name="last_name" type="varchar"/>
            <column name="email" type="varchar" notnull="true"/>
            <column name="avatar" type="varchar"/>
            <column name="google_auth_id" type="varchar"/>
            <column name="role" type="varchar(5)" defaultValue="'USER'" notnull="true" checkConstraint="check ( role in ('USER','ADMIN'))" checkConstraintName="ck_users_role"/>
            <column name="created_at" type="timestamp" notnull="true"/>
            <column name="updated_at" type="timestamp" notnull="true"/>
            <column name="is_deleted" type="boolean" defaultValue="false" notnull="true"/>
            <uniqueConstraint name="uq_users_email" columnNames="email" oneToOne="false" nullableColumns=""/>
        </createTable>
        <createTable name="user_balance" pkName="pk_user_balance">
            <column name="id" type="bigint" primaryKey="true"/>
            <column name="user_id" type="bigint" notnull="true"/>
            <column name="friend_id" type="bigint" notnull="true"/>
            <column name="balance" type="double" notnull="true"/>
            <column name="created_at" type="timestamp" notnull="true"/>
            <column name="updated_at" type="timestamp" notnull="true"/>
            <column name="is_deleted" type="boolean" defaultValue="false" notnull="true"/>
        </createTable>
    </changeSet>
</migration>